# Workflow

## The Actual Workflow

### As a System Integrator (SI), your role is:

1. **Pre-submission Preparation**:
    - Configure and map the remaining fields that need to be added to taxpayers' ERP systems to ensure data compatibility with Universal Business Language (UBL)
    - Ensure all 55 mandatory fields are complete
    - Format the invoice in UBL 3.0 XML or JSON
    - Apply initial digital signature using ECDSA
2. **Transmission to APP**:
    - The SI guarantees data compatibility in line with UBL and facilitates accurate transmission of invoices to the Access Point Provider (APP)
    - You don't add the QR code at this stage

### The FIRS Generates the QR Code and CSID:

**Key Point**: Once approved, FIRS will issue a Cryptographic Stamp Identifier (CSID) and an Invoice Reference Number (IRN) within two to four hours. These validated invoices, which include a QR code for authentication, can then be sent to buyers

The sequence is:

1. SI prepares a compliant invoice with a digital signature
2. APP validates and transmits to FIRS
3. **FIRS validates and returns**:
    - Invoice Reference Number (IRN)
    - Cryptographic Stamp Identifier (CSID)
    - QR code
4. SI/APP adds these FIRS-generated elements to create the final invoice
5. Final validated invoice (now with QR code) is sent to the buyer

## Why FIRS Controls QR Code Generation

All cryptographic credentials are generated by the FIRS root server, which provides each taxpayer with a public key and certificate for QR-code creation

This centralized approach ensures:

- The QR code can only be validated with FIRS's private key
- Prevents tampering and counterfeit invoices
- Maintains audit trail and control

## Your Responsibilities as SI

1. **Before FIRS submission**:
    - Prepare invoice with correct UBL format
    - Apply ECDSA digital signature
    - Validate all mandatory fields
    - Ensure OAuth 2.0 authentication is configured
2. **After FIRS approval**:
    - Receive IRN, CSID, and QR code from FIRS (via APP)
    - Integrate these elements into the final invoice
    - Generate a PDF with an embedded QR code
    - Ensure the QR code is properly positioned and scannable

**No, you don't append the QR code before transmission to FIRS. You apply the digital signature before submission, but the QR code is generated BY FIRS and returned to you after validation, which you then add to create the final compliant invoice.**